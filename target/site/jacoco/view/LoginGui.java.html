<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LoginGui.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gui</a> &gt; <a href="index.source.html" class="el_package">view</a> &gt; <span class="el_source">LoginGui.java</span></div><h1>LoginGui.java</h1><pre class="source lang-java linenums">package view;

import javafx.application.Application;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.Scene;
import javafx.scene.control.*;
import javafx.scene.layout.VBox;
import javafx.stage.Stage;
import model.service.LocaleManager;
import model.service.UserSession;
import model.DAO.KayttajaDAO;
import org.mindrot.jbcrypt.BCrypt;

import java.util.ResourceBundle;

<span class="fc" id="L17">public class LoginGui extends Application {</span>

<span class="fc" id="L19">    private KayttajaDAO kayttajaDAO = new KayttajaDAO();</span>
    private ResourceBundle bundle;
    private Label loginLabel, emailLabel, passwordLabel;
    private Button loginButton, registerButton;
    private TextField emailField;
    private PasswordField passwordField;

    @Override
    public void start(Stage primaryStage) {
        // Load the ResourceBundle from LocaleManager
<span class="fc" id="L29">        bundle = LocaleManager.getBundle();</span>
<span class="fc" id="L30">        primaryStage.setTitle(bundle.getString(&quot;title.login&quot;));</span>

        // Language Selection ComboBox
<span class="fc" id="L33">        ComboBox&lt;String&gt; languageSelector = new ComboBox&lt;&gt;();</span>
<span class="fc" id="L34">        languageSelector.getItems().addAll(&quot;English&quot;, &quot;Svenska&quot;, &quot;中文&quot;, &quot;Suomi&quot;, &quot;россия&quot;);</span>
<span class="fc" id="L35">        languageSelector.setValue(LocaleManager.getLanguageName()); // Default selection</span>
<span class="pc" id="L36">        languageSelector.setOnAction(e -&gt; updateLanguage(languageSelector.getValue(), primaryStage));</span>

        // Labels and Buttons
<span class="fc" id="L39">        loginLabel = new Label(bundle.getString(&quot;label.login&quot;));</span>
<span class="fc" id="L40">        emailLabel = new Label(bundle.getString(&quot;label.email&quot;));</span>
<span class="fc" id="L41">        emailField = new TextField();</span>
<span class="fc" id="L42">        emailField.setPromptText(bundle.getString(&quot;label.email&quot;));</span>

<span class="fc" id="L44">        passwordLabel = new Label(bundle.getString(&quot;label.password&quot;));</span>
<span class="fc" id="L45">        passwordField = new PasswordField();</span>
<span class="fc" id="L46">        passwordField.setPromptText(bundle.getString(&quot;label.password&quot;));</span>

<span class="fc" id="L48">        loginButton = new Button(bundle.getString(&quot;button.login&quot;));</span>
<span class="fc" id="L49">        registerButton = new Button(bundle.getString(&quot;button.register&quot;));</span>

        // Layout
<span class="fc" id="L52">        VBox vbox = new VBox(10);</span>
<span class="fc" id="L53">        vbox.setAlignment(Pos.CENTER);</span>
<span class="fc" id="L54">        vbox.setPadding(new Insets(20));</span>
<span class="fc" id="L55">        vbox.getChildren().addAll(languageSelector, loginLabel, emailLabel, emailField, passwordLabel, passwordField, loginButton, registerButton);</span>

        // Event Handlers
<span class="pc" id="L58">        loginButton.setOnAction(e -&gt; handleLogin(emailField.getText(), passwordField.getText(), primaryStage));</span>
<span class="fc" id="L59">        registerButton.setOnAction(e -&gt; {</span>
<span class="nc" id="L60">            primaryStage.close();</span>
<span class="nc" id="L61">            new RegistrationGui().start(new Stage());</span>
<span class="nc" id="L62">        });</span>

<span class="fc" id="L64">        Scene scene = new Scene(vbox, 300, 350);</span>
<span class="fc" id="L65">        scene.getStylesheets().add(getClass().getResource(&quot;/login.css&quot;).toExternalForm());</span>
<span class="fc" id="L66">        primaryStage.setScene(scene);</span>
<span class="fc" id="L67">        primaryStage.show();</span>
<span class="fc" id="L68">    }</span>

    private void handleLogin(String email, String password, Stage primaryStage) {
<span class="nc" id="L71">        String savedHashedPassword = kayttajaDAO.findPasswordByEmail(email);</span>

<span class="nc bnc" id="L73" title="All 4 branches missed.">        if (savedHashedPassword != null &amp;&amp; BCrypt.checkpw(password, savedHashedPassword)) {</span>
<span class="nc" id="L74">            String rooli = kayttajaDAO.findRooliByEmail(email);</span>
<span class="nc" id="L75">            UserSession.setUsername(email);</span>
<span class="nc" id="L76">            UserSession.setRooli(rooli);</span>

<span class="nc" id="L78">            primaryStage.close();</span>
<span class="nc" id="L79">            new OhjelmistoGUI().start(new Stage());</span>
<span class="nc" id="L80">        } else {</span>
<span class="nc" id="L81">            Alert alert = new Alert(Alert.AlertType.ERROR);</span>
<span class="nc" id="L82">            alert.setTitle(bundle.getString(&quot;alert.login.failed.title&quot;));</span>
<span class="nc" id="L83">            alert.setContentText(bundle.getString(&quot;alert.login.failed.message&quot;));</span>
<span class="nc" id="L84">            alert.showAndWait();</span>
        }
<span class="nc" id="L86">    }</span>

    private void updateLanguage(String selectedLanguage, Stage primaryStage) {
<span class="nc" id="L89">        LocaleManager.setLocale(selectedLanguage);</span>
<span class="nc" id="L90">        bundle = LocaleManager.getBundle();</span>
<span class="nc" id="L91">        refreshUI(primaryStage);</span>
<span class="nc" id="L92">    }</span>

    private void refreshUI(Stage primaryStage) {
<span class="nc" id="L95">        primaryStage.setTitle(bundle.getString(&quot;title.login&quot;));</span>
<span class="nc" id="L96">        loginLabel.setText(bundle.getString(&quot;label.login&quot;));</span>
<span class="nc" id="L97">        emailLabel.setText(bundle.getString(&quot;label.email&quot;));</span>
<span class="nc" id="L98">        passwordLabel.setText(bundle.getString(&quot;label.password&quot;));</span>
<span class="nc" id="L99">        loginButton.setText(bundle.getString(&quot;button.login&quot;));</span>
<span class="nc" id="L100">        registerButton.setText(bundle.getString(&quot;button.register&quot;));</span>
<span class="nc" id="L101">        emailField.setPromptText(bundle.getString(&quot;label.email&quot;));</span>
<span class="nc" id="L102">        passwordField.setPromptText(bundle.getString(&quot;label.password&quot;));</span>
<span class="nc" id="L103">    }</span>

    public static void main(String[] args) {
<span class="nc" id="L106">        launch(args);</span>
<span class="nc" id="L107">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>